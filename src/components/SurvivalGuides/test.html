<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤œå¸‚é‡£è¦å°éŠæˆ² (GSAP Demo)</title>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #222;
            font-family: sans-serif;
        }

        .game-wrapper {
            width: 100vw;
            height: 100vh;
            background: #001f3f;
            /* æ·±è—è‰²èƒŒæ™¯ */
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .ui-score {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            z-index: 100;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 10px;
        }

        .game-area {
            width: 800px;
            height: 600px;
            background: rgba(255, 255, 255, 0.05);
            border: 4px solid #fff;
            position: relative;
            overflow: hidden;
            cursor: crosshair;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }

        /* === é‰¤å­ç›¸é—œ === */
        .hook-container {
            position: absolute;
            top: 0;
            left: 50%;
            width: 0;
            height: 0;
            z-index: 10;
        }

        .line {
            width: 4px;
            height: 50px;
            /* åˆå§‹é•·åº¦ */
            background-color: #fff;
            margin: 0 auto;
            position: relative;
            transform-origin: top center;
        }

        .claw {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px white;
        }

        /* === ç‰©å“ç›¸é—œ === */
        .item {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            user-select: none;
        }

        .item span {
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        /* é»æ“Šæç¤º */
        .hint {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            pointer-events: none;
        }
    </style>
</head>

<body>

    <div id="app">
        <div class="game-wrapper">
            <div class="ui-score">Score: {{ score }}</div>

            <div class="game-area" ref="gameAreaRef" @click="shoot">

                <div class="hook-container" ref="hookRef">
                    <div class="line" ref="lineRef"></div>
                    <div class="claw" ref="clawRef">âš“</div>
                </div>

                <div v-for="item in items" :key="item.id" class="item" :style="{ 
                         left: item.x + 'px', 
                         top: item.y + 'px',
                         width: item.width + 'px',
                         height: item.height + 'px'
                     }">
                    <span v-if="item.type === 'shrimp'">ğŸ¦</span>
                    <span v-if="item.type === 'trash'">ğŸ›</span>
                    <span v-if="item.type === 'treasure'">ğŸ</span>
                </div>

                <div class="hint">é»æ“Šç•«é¢æˆ–æ˜¯æŒ‰ç©ºç™½éµç™¼å°„é‰¤å­</div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, onUnmounted } = Vue;

        createApp({
            setup() {
                // === éŠæˆ²è³‡æ–™ ===
                const score = ref(0);
                const gameAreaRef = ref(null);
                const hookRef = ref(null);
                const lineRef = ref(null);
                const clawRef = ref(null);

                const items = ref([
                    { id: 1, type: 'shrimp', x: 150, y: 400, width: 60, height: 60, score: 100, caught: false },
                    { id: 2, type: 'shrimp', x: 600, y: 350, width: 60, height: 60, score: 100, caught: false },
                    { id: 3, type: 'trash', x: 350, y: 500, width: 50, height: 50, score: 10, caught: false },
                    { id: 4, type: 'treasure', x: 500, y: 520, width: 70, height: 70, score: 500, caught: false },
                    { id: 5, type: 'shrimp', x: 100, y: 250, width: 60, height: 60, score: 100, caught: false },
                ]);

                let swingTween = null;
                let shootTween = null;
                let isShooting = false;

                // === å‹•ä½œé‚è¼¯ ===
                const startSwing = () => {
                    isShooting = false;
                    // ä½¿ç”¨ GSAP è®“é‰¤å­æ“ºç›ª
                    swingTween = gsap.to(hookRef.value, {
                        rotation: 70,
                        duration: 1.5,
                        ease: "sine.inOut",
                        yoyo: true,
                        repeat: -1,
                        transformOrigin: "top center"
                    });
                    gsap.set(hookRef.value, { rotation: -70 });
                };

                const shoot = () => {
                    if (isShooting) return;
                    isShooting = true;
                    swingTween.pause();

                    // ç™¼å°„ï¼šæ”¹è®Šç¹©å­é•·åº¦
                    shootTween = gsap.to(lineRef.value, {
                        height: '800px',
                        duration: 1,
                        ease: "none",
                        onUpdate: checkCollision,
                        onComplete: () => retract(null)
                    });
                };

                const retract = (caughtItem) => {
                    // æŠ“åˆ°æ±è¥¿æ¯”è¼ƒæ…¢
                    const duration = caughtItem ? 1.5 : 0.5;

                    gsap.to(lineRef.value, {
                        height: '50px',
                        duration: duration,
                        ease: "power1.out",
                        onUpdate: () => {
                            if (caughtItem) updateItemPosition(caughtItem);
                        },
                        onComplete: () => {
                            if (caughtItem) {
                                score.value += caughtItem.score;
                                // ç§»é™¤ç‰©å“
                                items.value = items.value.filter(i => i.id !== caughtItem.id);
                            }
                            swingTween.resume();
                            isShooting = false;
                        }
                    });
                };

                // === ç¢°æ’åµæ¸¬ ===
                const checkCollision = () => {
                    const clawRect = clawRef.value.getBoundingClientRect();
                    const gameAreaRect = gameAreaRef.value.getBoundingClientRect();

                    // æ›ç®—æˆç›¸å°åº§æ¨™
                    const clawX = clawRect.left - gameAreaRect.left + clawRect.width / 2;
                    const clawY = clawRect.top - gameAreaRect.top + clawRect.height / 2;

                    for (let item of items.value) {
                        if (item.caught) continue;

                        const dx = clawX - (item.x + item.width / 2);
                        const dy = clawY - (item.y + item.height / 2);
                        const distance = Math.sqrt(dx * dx + dy * dy);

                        if (distance < 40) {
                            console.log("æŠ“åˆ°äº†!", item.type);
                            shootTween.kill(); // åœæ­¢ç™¼å°„
                            item.caught = true;
                            retract(item); // é–‹å§‹æ‹‰å›
                            return;
                        }
                    }
                };

                const updateItemPosition = (item) => {
                    const clawRect = clawRef.value.getBoundingClientRect();
                    const gameAreaRect = gameAreaRef.value.getBoundingClientRect();

                    item.x = clawRect.left - gameAreaRect.left - (item.width / 2);
                    item.y = clawRect.top - gameAreaRect.top;
                };

                onMounted(() => {
                    startSwing();
                    window.addEventListener('keydown', (e) => {
                        if (e.code === 'Space') shoot();
                    });
                });

                return {
                    score, items, gameAreaRef, hookRef, lineRef, clawRef, shoot
                };
            }
        }).mount('#app');
    </script>
</body>

</html>